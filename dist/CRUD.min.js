!function e(t,n,r){function i(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return i(n?n:e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){function r(e){var t={},n=e.length-1,r=e[0],i=e[n];for(var o in r)t[r[o]]=0;for(var o=1;n>=o;o++){var a=e[o];for(var u in a){var s=a[u];t[s]===o-1&&(t[s]=o)}}var f=[];for(var o in i){var s=i[o];t[s]===n&&f.push(s)}return f}function i(e,t){if(!t)return r(e);for(var n=[],i=0;i<e.length;i++)o(t,e[i])>-1&&n.push(e[i]);return n}function o(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}t.exports=i,i.big=function(e,t){if(!t)return r(e);for(var n=[],i={},o=0;o<t.length;o++)i[t[o]]=!0;for(var o=0;o<e.length;o++)i[e[o]]&&n.push(e[o]);return n}},{}],2:[function(e,t,n){"use strict";t.exports=function(e){return"object"==typeof e&&null!==e}},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("intersect"),f=r(s),d=e("is-object"),c=r(d),l=e("./storage.js"),h=r(l),v=e("./StorageDriver.js"),g=r(v),m=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,e),this.conf=Object.assign({name:"database",indexedKeys:[],uniqueKey:"id",verbose:!1,driver:new g["default"]({name:t.name,storage:h["default"]})},t),this._initialize()}return u(e,[{key:"_initialize",value:function(){this._data=this._load(),this._id=Math.max.apply(Math,i(this._data).concat([0]))}},{key:"find",value:function(){var e,t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r={indexed:{},unindexed:{}};for(var o in n){var a=this.conf.indexedKeys.includes(o)?"indexed":"unindexed";r[a][o]=n[o]}var u=Object.keys(r.indexed).map(function(e){return t.conf.driver.getItem(e+":"+r.indexed[e])||!1}),s=0===u.length?this._data:1===u.length?u:f["default"].apply(void 0,i(u));return s.map((e=this.conf.driver).getItem.bind(e)).filter(function(e){return Object.keys(r.unindexed).every(function(t){return e[t]===r.unindexed[t]})})}},{key:"insert",value:function(e){if(Array.isArray(e))return e.forEach(this.insert.bind(this));if(!(0,c["default"])(e))throw new Error("Canâ€™t insert "+e+". Please insert object.");if(this._id++,this._data.includes(this._id))return this._log("Existing entry for "+this._id+". Aborting.");var t=Object.assign({},e,o({},this.conf.uniqueKey,this._id));return this._data.push(this._id),this.conf.driver.setItem(this._id,t),this.conf.driver.setItem("__data",this._data.join(",")),this._buildIndex(t),this._id}},{key:"update",value:function(e,t){if(this._data.includes(e)){var n=Object.assign({},t,o({},this.conf.uniqueKey,e));return this._destroyIndex(e),this.conf.driver.setItem(e,t),this._buildIndex(t),n}this._log("No entry found for "+e+".")}},{key:"delete",value:function(e){return(0,c["default"])(e)?this._findAndDelete(e):this._data.includes(e)?(this._data.splice(this._data.indexOf(e),1),this.conf.driver.removeItem(e),this.conf.driver.setItem("__data",this._data.join(",")),this._destroyIndex(e),!this._data.includes(e)):void this._log("No entry found for "+e+".")}},{key:"count",value:function(){return this._data.length}},{key:"drop",value:function(){return this._data.forEach(this["delete"].bind(this)),this.conf.driver.removeItem("__data"),this._data.length=0,0===this._data.length}},{key:"_findAndDelete",value:function(e){var t=this,n=this._data.length;return this.find(e).forEach(function(e){return t["delete"](e[t.conf.uniqueKey])}),this._data.length<n}},{key:"_load",value:function(){var e=this.conf.driver.getItem("__data");return e?e.split(",").map(Number):[]}},{key:"_buildIndex",value:function(e){for(var t in e)if(this.conf.indexedKeys.includes(t)){var n=t+":"+e[t],r=this.conf.driver.getItem(n),i=[e[this.conf.uniqueKey]];null!==r&&(r.push(e[this.conf.uniqueKey]),i=r),this.conf.driver.setItem(n,i)}}},{key:"_destroyIndex",value:function(e){var t=this.conf.driver.getItem(e);if(null!==t)for(var n in t)if(this.conf.indexedKeys.includes(n)){var r=n+":"+t[n],i=this.conf.driver.getItem(r);null!==i&&(i.splice(i.indexOf(e),1),0===i.length?this.conf.driver.removeItem(r):this.conf.driver.setItem(r,i))}}},{key:"_log",value:function(e){this.conf.verbose!==!1&&"undefined"!=typeof console&&console.log(e)}}]),e}();n["default"]=m,t.exports=n["default"]},{"./StorageDriver.js":4,"./storage.js":5,intersect:1,"is-object":2}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(r(this,e),this.conf=t,"function"!=typeof this.conf.storage.getItem||"function"!=typeof this.conf.storage.removeItem||"function"!=typeof this.conf.storage.setItem)throw new Error("Given Storage doesn't have methods `getItem`, `setItem` and `removeItem`.")}return i(e,[{key:"setItem",value:function(e,t){return this.conf.storage.setItem(this.conf.name+":"+e,JSON.stringify(t))}},{key:"getItem",value:function(e){return JSON.parse(this.conf.storage.getItem(this.conf.name+":"+e))}},{key:"removeItem",value:function(e){return this.conf.storage.removeItem(this.conf.name+":"+e)}}]),e}();n["default"]=o,t.exports=n["default"]},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={};n["default"]="undefined"!=typeof localStorage?localStorage:{getItem:function(e){return r[e]||null},setItem:function(e,t){return r[e]=t},removeItem:function(e){return delete r[e]}},t.exports=n["default"]},{}]},{},[3]);
