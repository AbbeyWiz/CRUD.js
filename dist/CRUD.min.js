!function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var s="function"==typeof require&&require;if(!u&&s)return s(o,!0);if(a)return a(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return i(n?n:e)},d,d.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(e){var t={},n=e.length-1,r=e[0],i=e[n];for(var a in r)t[r[a]]=0;for(var a=1;n>=a;a++){var o=e[a];for(var u in o){var s=o[u];t[s]===a-1&&(t[s]=a)}}var f=[];for(var a in i){var s=i[a];t[s]===n&&f.push(s)}return f}function i(e,t){if(!t)return r(e);for(var n=[],i=0;i<e.length;i++)a(t,e[i])>-1&&n.push(e[i]);return n}function a(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}t.exports=i,i.big=function(e,t){if(!t)return r(e);for(var n=[],i={},a=0;a<t.length;a++)i[t[a]]=!0;for(var a=0;a<e.length;a++)i[e[a]]&&n.push(e[a]);return n}},{}],2:[function(e,t,n){"use strict";t.exports=function(e){return"object"==typeof e&&null!==e}},{}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./storage.js"),s=r(u),f=e("./StorageDriver.js"),d=r(f),c=e("intersect"),l=r(c),h=e("is-object"),v=r(h),m=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];a(this,e),this.conf=Object.assign({name:"database",indexedKeys:[],uniqueKey:"id",driver:new d["default"]({name:t.name,storage:s["default"]})},t),this.initialize()}return o(e,[{key:"initialize",value:function(){this.data=this.load()||[],this.id=0,this.data.length>0&&(this.data=this.data.map(Number),this.id=Math.max.apply(Math,i(this.data)))}},{key:"find",value:function(e){if("undefined"==typeof e)return this.findAll();var t=this.getKeys(e),n=[],r=void 0;for(var i in t.indexed){var a=i+":"+t.indexed[i];n.push(this.conf.driver.getItem(a)||!1)}return r=0===n.length?this.data:1===n.length?n[0]:l["default"].apply(void 0,n),this.filter(this.select(r),t.unindexed)}},{key:"findAll",value:function(){return this.select(this.data)}},{key:"getKeys",value:function(e){var t={indexed:{},unindexed:{}};for(var n in e){var r=this.conf.indexedKeys.includes(n)?"indexed":"unindexed";t[r][n]=e[n]}return t}},{key:"select",value:function(e){var t;return Array.from(e).map((t=this.conf.driver).getItem.bind(t))}},{key:"filter",value:function(e,t){return e.filter(function(e){return Object.keys(t).every(function(n){return e[n]===t[n]})})}},{key:"insert",value:function(e){if(!(0,v["default"])(e))throw new Error("Can't insert "+e+". Please insert object.");return this.id++,this.data.includes(this.id)?(e[this.conf.uniqueKey]=this.id,this.data.push(this.id),this.conf.driver.setItem(this.id,e),this.conf.driver.setItem("__data",this.data.join(",")),this.buildIndex(e),this.id):void 0}},{key:"update",value:function(e,t){return this.data.includes(e)?(this.destroyIndex(e),t[this.conf.uniqueKey]=e,this.conf.driver.setItem(e,t),this.buildIndex(t),t):void 0}},{key:"delete",value:function(e){if((0,v["default"])(e))this.findAndDelete(e);else if(this.data.includes(e))return this.data.splice(this.data.indexOf(e),1),this.destroyIndex(e),this.conf.driver.removeItem(e),this.conf.driver.setItem("__data",this.data.join(",")),-1===this.data.indexOf(e)}},{key:"findAndDelete",value:function(e){var t=this,n=this.data.length;return this.find(e).forEach(function(e){var n=e[t.conf.uniqueKey];t.data.includes(n)&&(t.data.splice(t.data.indexOf(n),1),t.destroyIndex(n),t.conf.driver.removeItem(n),t.conf.driver.setItem("__data",t.data.join(",")))}),this.data.length<n}},{key:"count",value:function(){return this.data.length}},{key:"drop",value:function(){return this.data.forEach(this["delete"].bind(this)),this.conf.driver.removeItem("__data"),this.data.length=0,0===this.data.length}},{key:"load",value:function(){return this.conf.driver.getItem("__data")?this.conf.driver.getItem("__data").split(","):null}},{key:"buildIndex",value:function(e){for(var t in e)if(this.conf.indexedKeys.includes(t)){var n=[e[this.conf.uniqueKey]],r=t+":"+e[t],i=this.conf.driver.getItem(r);null!==i&&(i.push(e[this.conf.uniqueKey]),n=i),this.conf.driver.setItem(r,n)}}},{key:"destroyIndex",value:function(e){var t=this.conf.driver.getItem(e);if(null!==t)for(var n in t)if(this.conf.indexedKeys.includes(n)){var r=n+":"+t[n],i=this.conf.driver.getItem(r);null!==i&&(i.splice(i.indexOf(e),1),0===i.length?this.conf.driver.removeItem(r):this.conf.driver.setItem(r,i))}}}]),e}();t.exports=m},{"./StorageDriver.js":4,"./storage.js":5,intersect:1,"is-object":2}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];if(r(this,e),this.conf=t,"function"!=typeof this.conf.storage.getItem||"function"!=typeof this.conf.storage.removeItem||"function"!=typeof this.conf.storage.setItem)throw new Error("Given Storage doesn't have methods `getItem`, `setItem` and `removeItem`.")}return i(e,[{key:"setItem",value:function(e,t){return this.conf.storage.setItem(this.conf.name+":"+e,JSON.stringify(t))}},{key:"getItem",value:function(e){return JSON.parse(this.conf.storage.getItem(this.conf.name+":"+e))}},{key:"removeItem",value:function(e){return this.conf.storage.removeItem(this.conf.name+":"+e)}}]),e}();t.exports=a},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={};n["default"]="undefined"!=typeof localStorage?localStorage:{getItem:function(e){return r[e]||null},setItem:function(e,t){r[e]=t},removeItem:function(e){delete r[e]}},t.exports=n["default"]},{}]},{},[3]);
