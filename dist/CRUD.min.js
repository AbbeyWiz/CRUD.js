!function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var d=n[o]={exports:{}};t[o][0].call(d.exports,function(e){var n=t[o][1][e];return r(n?n:e)},d,d.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("./helpers.js"),s=e("./StorageDriver.js"),u=i(s),f=function(){function e(t){r(this,e),this.conf=(0,o.extend)({name:"database",indexedKeys:[],uniqueKey:"id",driver:new u["default"]({name:t.name,storage:o.storage})},t||{}),this.initialize()}return a(e,[{key:"initialize",value:function(){this.data=this.load()||[],this.id=0,this.data.length>0&&(this.data=this.data.map(function(e){return parseInt(e,10)}),this.id=Math.max.apply(Math,this.data))}},{key:"find",value:function(e){if("undefined"==typeof e)return this.findAll();var t=this.getKeys(e),n=[],i=void 0;for(var r in t.indexed){var a=r+":"+t.indexed[r];n.push(this.conf.driver.getItem(a)||!1)}return i=0===n.length?this.data:1===n.length?n[0]:o.intersect.apply(this,n),this.filter(this.select(i),t.unindexed)}},{key:"findAll",value:function(){return this.select(this.data)}},{key:"getKeys",value:function(e){var t={indexed:{},unindexed:{}};for(var n in e){var i=-1!==this.conf.indexedKeys.indexOf(n)?"indexed":"unindexed";t[i][n]=e[n]}return t}},{key:"select",value:function(e){var t=this;return e=Array.isArray(e)?e:[e],e.map(function(e){return t.conf.driver.getItem(e)})}},{key:"filter",value:function(e,t){return e.map(function(e){for(var n in t)if(e[n]!==t[n])return!1;return e}).filter(function(e){return e})}},{key:"insert",value:function(e){if("object"!=typeof e||null===e)throw new Error("Can't insert "+e+". Please insert object.");return this.id++,-1===this.data.indexOf(this.id)?(e[this.conf.uniqueKey]=this.id,this.data.push(this.id),this.conf.driver.setItem(this.id,e),this.conf.driver.setItem("__data",this.data.join(",")),this.buildIndex(e),this.id):void 0}},{key:"update",value:function(e,t){return-1!==this.data.indexOf(e)?(this.destroyIndex(e),t[this.conf.uniqueKey]=e,this.conf.driver.setItem(e,t),this.buildIndex(t),t):void 0}},{key:"delete",value:function(e){if("object"==typeof e&&null!==e)this.findAndDelete(e);else if(-1!==this.data.indexOf(e))return this.data.splice(this.data.indexOf(e),1),this.destroyIndex(e),this.conf.driver.removeItem(e),this.conf.driver.setItem("__data",this.data.join(",")),-1===this.data.indexOf(e)}},{key:"findAndDelete",value:function(e){for(var t=this.find(e),n=this.data.length,i=0;i<t.length;i++){var r=t[i][this.conf.uniqueKey];-1!==this.data.indexOf(r)&&(this.data.splice(this.data.indexOf(r),1),this.destroyIndex(r),this.conf.driver.removeItem(r),this.conf.driver.setItem("__data",this.data.join(",")))}return this.data.length<n}},{key:"count",value:function(){return this.data.length}},{key:"drop",value:function(){var e=this;return this.data.forEach(function(t){return e["delete"](t)}),this.conf.driver.removeItem("__data"),this.data.length=0,0===this.data.length}},{key:"load",value:function(){return this.conf.driver.getItem("__data")?this.conf.driver.getItem("__data").split(","):null}},{key:"buildIndex",value:function(e){for(var t in e)if(-1!==this.conf.indexedKeys.indexOf(t)){var n=[e[this.conf.uniqueKey]],i=t+":"+e[t],r=this.conf.driver.getItem(i);null!==r&&(r.push(e[this.conf.uniqueKey]),n=r),this.conf.driver.setItem(i,n)}}},{key:"destroyIndex",value:function(e){var t=this.conf.driver.getItem(e);if(null!==t)for(var n in t)if(-1!==this.conf.indexedKeys.indexOf(n)){var i=n+":"+t[n],r=this.conf.driver.getItem(i);null!==r&&(r.splice(r.indexOf(e),1),0===r.length?this.conf.driver.removeItem(i):this.conf.driver.setItem(i,r))}}}]),e}();t.exports=f},{"./StorageDriver.js":2,"./helpers.js":3}],2:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){if(i(this,e),this.conf=t||{},"function"!=typeof this.conf.storage.getItem||"function"!=typeof this.conf.storage.removeItem||"function"!=typeof this.conf.storage.setItem)throw new Error("Given Storage doesn't have methods `getItem`, `setItem` and `removeItem`.")}return r(e,[{key:"setItem",value:function(e,t){return this.conf.storage.setItem(this.conf.name+":"+e,JSON.stringify(t))}},{key:"getItem",value:function(e){return JSON.parse(this.conf.storage.getItem(this.conf.name+":"+e))}},{key:"removeItem",value:function(e){return this.conf.storage.removeItem(this.conf.name+":"+e)}}]),e}();t.exports=a},{}],3:[function(e,t,n){"use strict";function i(e,t){if(e=e||{},arguments.length>2)for(var n=1;n<arguments.length;n++)window.extend(e,arguments[n]);else for(var i in t)e[i]=t[i];return e}function r(){var e,t,n,i,r,a,o=[],s={};for(a=arguments.length-1,n=arguments[0].length,t=0,e=0;a>=e;e++)i=arguments[e].length,n>i&&(t=e,n=i);for(e=0;a>=e;e++){i=e===t?0:e||t,r=arguments[i].length;for(var u=0;r>u;u++){var f=arguments[i][u];s[f]===e-1?e===a?(o.push(f),s[f]=0):s[f]=e:0===e&&(s[f]=0)}}return o}function a(){if("undefined"!=typeof localStorage)return localStorage;var e={};return{getItem:function(t){return e[t]||null},setItem:function(t,n){e[t]=n},removeItem:function(t){delete e[t]}}}t.exports={extend:i,intersect:r,storage:a()}},{}]},{},[1]);